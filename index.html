<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ourochest Master V31</title>
    <style>
        :root {
            --bg: #050508;
            --panel: #11131a;
            --border: #2a2e3f;
            --text-main: #eceff4;
            --text-dim: #94a3b8;
            
            /* PALETA */
            --blue: #3b82f6;      
            --green: #2ecc71;     
            --turquoise: #00e5ff; 
            --yellow: #f1c40f;    
            --orange: #e67e22;    
            --red: #ff3b30;       
            
            --cell-bg: #161920;
            --gold: #ffd700;
            --suggest: #d900ff; 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        header {
            background-color: var(--panel);
            border-bottom: 1px solid var(--border);
            height: 50px; /* Header más compacto */
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            flex-shrink: 0;
            z-index: 100;
        }

        .logo { font-weight: 900; font-size: 1.1rem; letter-spacing: 1px; color: #fff; text-transform: uppercase; }
        .logo span { color: var(--gold); }

        .controls { display: flex; gap: 10px; align-items: center; }

        select { 
            background: #1a1e29; color: white; border: 1px solid var(--border); 
            padding: 4px 15px 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; cursor: pointer;
        }

        #main-container { 
            flex: 1; 
            overflow-y: auto; 
            padding: 15px; 
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Alineado arriba para no centrar verticalmente en pantallas grandes */
        }

        .dual-container { 
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px; 
            width: 100%; 
            max-width: 1000px; /* Limite total para que no se separen mucho */
        }

        .panel { 
            background: var(--panel); border: 1px solid var(--border); border-radius: 12px; 
            padding: 15px; display: flex; flex-direction: column; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
            flex: 1;
            min-width: 320px; /* Ancho mínimo para móvil */
            max-width: 450px; /* Ancho máximo para PC (Grid controlado) */
        }

        h2 { 
            width: 100%; display: flex; justify-content: space-between; align-items: center;
            margin: 0 0 10px 0; padding-bottom: 8px; border-bottom: 2px solid var(--border);
            color: white; font-size: 1rem; 
        }

        /* GRID COMPACTO Y PERFECTO */
        .grid-container-wrapper {
            width: 100%;
            max-width: 340px; /* TAMAÑO CONTROLADO EN PC */
            margin: 0 auto 15px auto;
        }

        .master-grid {
            display: grid;
            grid-template-columns: 20px repeat(5, 1fr);
            gap: 4px;
            width: 100%;
            /* Aspect ratio cuadrado perfecto contando headers */
            aspect-ratio: 5.5 / 5.5; 
        }

        .coord-header { 
            display: flex; justify-content: center; align-items: center; 
            font-size: 0.8rem; color: var(--text-dim); font-weight: bold;
        }

        .cell {
            width: 100%; height: 100%;
            background-color: var(--cell-bg);
            border: 1px solid #333a4d; border-radius: 4px;
            cursor: pointer; display: flex; justify-content: center; align-items: center;
            font-size: 1.1rem; /* Texto más discreto */
            font-weight: bold;
            position: relative; transition: transform 0.1s; touch-action: manipulation;
        }
        .cell:active { transform: scale(0.95); }

        .cell.revealed { cursor: default; transform: none; box-shadow: inset 0 0 5px rgba(0,0,0,0.5); border-color: transparent; }
        
        /* Colores */
        .cell.blue, .cell.input-blue { border-color: var(--blue) !important; color: var(--blue); background: rgba(59, 130, 246, 0.15) !important; }
        .cell.green, .cell.input-green { border-color: var(--green) !important; color: var(--green); background: rgba(46, 204, 113, 0.15) !important; }
        .cell.turquoise, .cell.input-turquoise { border-color: var(--turquoise) !important; color: var(--turquoise); background: rgba(0, 229, 255, 0.15) !important; }
        .cell.yellow, .cell.input-yellow { border-color: var(--yellow) !important; color: var(--yellow); background: rgba(241, 196, 15, 0.15) !important; }
        .cell.orange, .cell.input-orange { border-color: var(--orange) !important; color: var(--orange); background: rgba(230, 126, 34, 0.15) !important; }
        .cell.red, .cell.input-red { background: var(--red) !important; box-shadow: 0 0 15px var(--red); border: 2px solid white !important; color: white !important; }

        .cell.eliminated { background: #080a0f; opacity: 0.3; cursor: not-allowed; border-color: #222; }
        
        /* SUGERENCIA (IA) */
        .cell.suggestion {
            border: 2px solid var(--suggest) !important;
            box-shadow: 0 0 10px var(--suggest), inset 0 0 10px rgba(217, 0, 255, 0.2);
            animation: pulse-suggest 1s infinite alternate;
            z-index: 10;
        }
        
        /* CANDIDATO A ROJA (MEJORADO) */
        .cell.red-candidate {
            /* Ya no es borde feo, es un glow rojo interno sutil */
            box-shadow: inset 0 0 0 2px rgba(255, 59, 48, 0.6);
            background: rgba(255, 59, 48, 0.05);
        }

        @keyframes pulse-suggest {
            from { opacity: 0.8; }
            to { opacity: 1; transform: scale(1.02); }
        }

        .solver-palette { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; width: 100%; margin-bottom: 15px; }
        .p-btn { padding: 8px 2px; border: 1px solid #333; cursor: pointer; color: white; font-size: 0.75rem; font-weight: bold; border-radius: 4px; text-align: center; white-space: nowrap; overflow: hidden; }
        .p-btn:hover { background: #222; }
        .p-btn.active { border-color: white; transform: translateY(-1px); box-shadow: 0 2px 5px rgba(0,0,0,0.5); }

        .err-msg { color: var(--red); font-weight: bold; margin-bottom: 5px; height: 15px; text-align: center; font-size: 0.9rem; opacity: 0; }
        
        .log-box { flex: 1; min-height: 120px; background: #0e1016; border: 1px solid #333; border-radius: 8px; overflow-y: auto; padding: 8px; display: flex; flex-direction: column; gap: 5px; }
        .log-entry { display: grid; grid-template-columns: 25px 1fr auto; align-items: center; gap: 8px; padding: 8px; border-radius: 4px; border-left: 3px solid #555; font-size: 0.85rem; animation: slideIn 0.2s; background: #1a1d26; }
        .log-desc strong { color: #fff; font-weight: 800; text-transform: uppercase; }
        .hint-text { display: block; font-size: 0.85em; opacity: 0.8; margin-top: 2px; color: #ccc; }

        /* Colores de Borde Log */
        .le-blue { border-color: var(--blue); } 
        .le-green { border-color: var(--green); } 
        .le-turq { border-color: var(--turquoise); } 
        .le-yell { border-color: var(--yellow); } 
        .le-orng { border-color: var(--orange); } 
        .le-red { border-color: var(--red); background: rgba(255, 59, 48, 0.1); } 

        .btn-reset { width: 100%; padding: 12px; margin-top: 15px; background: var(--blue); color: white; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 0.95rem; }
        .btn-red { background: var(--red); }
        .btn-dark { background: #222; border: 1px solid #e74c3c; color: #e74c3c; }
        .summary-card { background: linear-gradient(135deg, #ffd90022, #000); border: 1px solid var(--gold); text-align: center; padding: 10px; color: white; margin-top: 5px; border-radius: 6px; }

        @media (max-width: 800px) {
            .dual-container { flex-direction: column; align-items: center; }
            .panel { width: 100%; max-width: 450px; }
            .logo { font-size: 1rem; } 
            header { padding: 0 10px; height: 50px; }
            .solver-palette { grid-template-columns: repeat(4, 1fr); }
            .coord-header { font-size: 0.75rem; }
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateX(-5px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .shake { animation: shake 0.4s ease-in-out; border-color: var(--red) !important; }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-4px);} 75% {transform: translateX(4px);} }

    </style>
</head>
<body>

    <header>
        <div class="logo"><span>OUROCHEST</span>MASTER</div>
        <div class="controls">
            <select id="langSelect" onchange="manualLangChange(this.value)">
                <option value="es">ES</option>
                <option value="en">EN</option>
            </select>
        </div>
    </header>

    <div id="main-container">
        
        <div class="dual-container">
            <!-- PANEL PRÁCTICA -->
            <div class="panel">
                <h2>
                    <span data-key="practice_title">Práctica</span> 
                    <span id="p-score" style="color:var(--gold)">0 pts</span>
                </h2>
                <div style="width:100%; margin-bottom:10px; display:flex; gap:15px; font-size:0.85rem; color:#aaa; font-weight:bold;">
                    <label style="display:flex; align-items:center; gap:8px; cursor:pointer;">
                        <input type="checkbox" id="hintToggle" onchange="toggleHints()" checked style="accent-color:var(--blue); transform:scale(1.2);"> 
                        <span data-key="lbl_hints">Mostrar Pistas</span>
                    </label>
                </div>
                
                <div class="grid-container-wrapper">
                    <div id="p-grid-container" class="master-grid"></div>
                </div>
                
                <div class="log-box" id="p-log"></div>
                <button class="btn-reset btn-red" onclick="resetPractice()" data-key="btn_restart">Reiniciar Partida</button>
            </div>

            <!-- PANEL SOLVER -->
            <div class="panel">
                <h2>Solver <span id="s-status" style="font-size:0.8rem; opacity:0.7">Start</span></h2>
                <div id="s-error" class="err-msg">IMPOSSIBLE</div>
                
                <div class="solver-palette">
                    <div class="p-btn active" style="background:var(--blue)" onclick="setTool('blue')">BLUE</div>
                    <div class="p-btn" style="background:var(--green)" onclick="setTool('green')">GRN</div>
                    <div class="p-btn" style="background:var(--turquoise)" onclick="setTool('turquoise')">TURQ</div>
                    <div class="p-btn" style="background:var(--yellow)" onclick="setTool('yellow')">YELL</div>
                    <div class="p-btn" style="background:var(--orange)" onclick="setTool('orange')">ORNG</div>
                    <div class="p-btn" style="background:var(--red)" onclick="setTool('red')">RED</div>
                    <div class="p-btn" style="background:#442222; border-color:#e74c3c; color:#ff3b30;" onclick="setTool('clear')">X</div>
                </div>

                <div class="grid-container-wrapper">
                    <div id="s-grid-container" class="master-grid"></div>
                </div>
                
                <button class="btn-reset btn-dark" onclick="resetSolver()" data-key="btn_clear">Limpiar Todo</button>
            </div>
        </div>

    </div>

    <script>
        // ============================================
        // 1. GENERADOR DE GRID (COMPACTO Y ROBUSTO)
        // ============================================
        function createGridHTML(prefix, isSolver = false) {
            let html = '';
            html += '<div class="coord-header"></div>';
            for(let i=1; i<=5; i++) html += `<div class="coord-header">${i}</div>`;
            for(let r=0; r<5; r++) {
                html += `<div class="coord-header">${r+1}</div>`;
                for(let c=0; c<5; c++) {
                    let onclick = isSolver ? `solverClick(${r},${c})` : `practiceClick(${r},${c})`;
                    let id = `${prefix}-cell-${r}-${c}`;
                    html += `<div id="${id}" class="cell" onclick="${onclick}"></div>`;
                }
            }
            return html;
        }

        document.getElementById('p-grid-container').innerHTML = createGridHTML('p');
        document.getElementById('s-grid-container').innerHTML = createGridHTML('s', true);

        // ============================================
        // 2. LÓGICA DE COLORES & PUNTOS
        // ============================================
        function getGeoType(rRed, cRed, r, c) {
            let dr = Math.abs(rRed - r);
            let dc = Math.abs(cRed - c);
            if (dr===0 && dc===0) return 'red';
            if ((dr===0 && dc===1) || (dr===1 && dc===0)) return 'adj';
            if (dr === dc) return 'diag'; 
            if (dr === 0 || dc === 0) return 'line';
            return 'far';
        }

        function getDistanceColor(rRed, cRed, r, c) {
            let geo = getGeoType(rRed, cRed, r, c);
            if (geo === 'red') return 'red';
            if (geo === 'adj') return 'orange';
            if (geo === 'diag') return 'yellow'; 
            if (geo === 'line') return 'green'; 
            return 'blue';
        }

        function isValidForColor(targetColor, geoType) {
            if (targetColor === 'red') return geoType === 'red';
            if (targetColor === 'orange') return geoType === 'adj';
            // Verde: Linea O Adj (si no salió naranja)
            if (targetColor === 'green') return (geoType === 'line' || geoType === 'adj');
            // Amarillo: Diagonal
            if (targetColor === 'yellow') return geoType === 'diag';
            // Turquesa: Comodín (Line, Adj, Diag)
            if (targetColor === 'turquoise') return (geoType === 'line' || geoType === 'adj' || geoType === 'diag');
            if (targetColor === 'blue') return geoType === 'far';
            return false;
        }

        function getPoints(color) {
            if (color === 'red') return 150;
            if (color === 'orange') return 90;
            if (color === 'yellow') return 55;
            if (color === 'green') return 35;
            if (color === 'turquoise') return 20;
            return 10;
        }

        // ============================================
        // 3. PRÁCTICA
        // ============================================
        let pState = { red: {r:0,c:0}, board: [], clicks:0, score:0, history:[], done:false, hints:true };

        function toggleHints() { pState.hints = document.getElementById('hintToggle').checked; renderLog(); }

        function resetPractice() {
            let redR, redC;
            do { redR = Math.floor(Math.random()*5); redC = Math.floor(Math.random()*5); } 
            while(redR===2 && redC===2);
            pState.red = {r: redR, c: redC};
            
            // Generación de tablero
            let neighbors=[], lines=[], diagonals=[], others=[];
            for(let r=0; r<5; r++) for(let c=0; c<5; c++) {
                if(r===redR && c===redC) continue;
                let dr = Math.abs(redR - r), dc = Math.abs(redC - c);
                if ((dr===0 && dc===1) || (dr===1 && dc===0)) neighbors.push({r,c});
                else if (dr === dc) diagonals.push({r,c});
                else if (dr === 0 || dc === 0) lines.push({r,c});
                else others.push({r,c});
            }
            const shuffle = (arr) => arr.sort(() => Math.random() - 0.5);
            shuffle(neighbors); shuffle(lines); shuffle(diagonals); shuffle(others);

            let oranges = neighbors.slice(0, 2);
            let fullLinePool = [...lines, ...neighbors.slice(2)]; shuffle(fullLinePool);
            let greens = fullLinePool.slice(0, 4);
            let yellows = diagonals.slice(0, 3);
            let validTurqPool = [...fullLinePool.slice(4), ...diagonals.slice(3)]; shuffle(validTurqPool);
            let numTurq = Math.floor(Math.random() * 3) + 3; 
            let turquoises = [];
            while(turquoises.length < numTurq && validTurqPool.length > 0) turquoises.push(validTurqPool.pop());

            let boardMap = Array(5).fill().map(() => Array(5).fill('blue'));
            boardMap[redR][redC] = 'red';
            oranges.forEach(p => boardMap[p.r][p.c] = 'orange');
            greens.forEach(p => boardMap[p.r][p.c] = 'green');
            yellows.forEach(p => boardMap[p.r][p.c] = 'yellow');
            turquoises.forEach(p => boardMap[p.r][p.c] = 'turquoise');

            pState.board = boardMap;
            pState.clicks = 0; pState.score = 0; pState.history = []; pState.done = false;
            pState.hints = document.getElementById('hintToggle').checked;
            renderPracticeState(); renderLog();
        }

        function practiceClick(r, c) {
            if(pState.done || pState.clicks>=5) return;
            if(pState.history.find(h=>h.r===r && h.c===c)) return;
            pState.clicks++;
            let color = pState.board[r][c];
            let pts = getPoints(color);
            pState.score += pts;
            pState.history.push({r,c,color,pts});
            if(pState.clicks>=5) pState.done = true;
            renderPracticeState(); addLogEntry(color, {r,c}, pts);
            if(pState.done) addLogSummary();
        }

        function renderPracticeState() {
            const sc = document.getElementById('p-score'); if(sc) sc.innerText = pState.score + ' pts';
            for(let r=0; r<5; r++) for(let c=0; c<5; c++) {
                let cell = document.getElementById(`p-cell-${r}-${c}`);
                if(cell) { 
                    cell.className = 'cell'; cell.style.opacity = '1'; cell.style.cursor = 'pointer'; 
                    cell.classList.remove('blue', 'green', 'turquoise', 'yellow', 'orange', 'red', 'revealed');
                }
            }
            pState.history.forEach(h => {
                let cell = document.getElementById(`p-cell-${h.r}-${h.c}`);
                if(cell) { 
                    let cssClass = h.color;
                    cell.classList.add('revealed', cssClass); 
                    cell.style.cursor = 'default'; 
                }
            });
            if(pState.done) {
                for(let r=0; r<5; r++) for(let c=0; c<5; c++) {
                    let cell = document.getElementById(`p-cell-${r}-${c}`);
                    if (!pState.history.some(h => h.r === r && h.c === c)) {
                        let trueColor = pState.board[r][c];
                        cell.classList.add(trueColor, 'revealed'); 
                        cell.style.opacity = '0.3'; 
                        cell.style.cursor = 'default';
                    }
                }
            }
        }

        // ============================================
        // 4. SOLVER IA MEJORADO (GREEDY + COUNTING)
        // ============================================
        let sState = { tool: 'blue', inputs: Array(5).fill().map(()=>Array(5).fill(null)) };
        function setTool(t) { sState.tool = t; document.querySelectorAll('.p-btn').forEach(b => b.classList.remove('active')); document.querySelectorAll(`.p-btn[onclick*="'${t}'"]`).forEach(b => b.classList.add('active')); }
        function resetSolver() { sState.inputs = Array(5).fill().map(()=>Array(5).fill(null)); renderSolver(); }
        
        function solverClick(r, c) {
            let next = sState.inputs.map(row => [...row]);
            let val = (sState.tool==='clear') ? null : sState.tool;
            next[r][c] = val;
            
            if (val === 'red') {
                sState.inputs = next;
                renderSolver();
                return;
            }

            if(val !== null && calcPoss(next) === 0) {
                showError("IMPOSSIBLE");
                let cell = document.getElementById(`s-cell-${r}-${c}`);
                if(cell){ cell.classList.add('shake'); setTimeout(()=>cell.classList.remove('shake'),400);}
                return;
            }
            sState.inputs = next; 
            renderSolver();
        }

        function calcPoss(inputs) {
            let count = 0;
            for(let r=0; r<5; r++) for(let c=0; c<5; c++) {
                if(r===2 && c===2) continue;
                let ok = true;
                for(let ir=0; ir<5; ir++) for(let ic=0; ic<5; ic++) {
                    let input = inputs[ir][ic];
                    if(input && input !== 'red') { 
                        let geo = getGeoType(r,c,ir,ic);
                        if (!isValidForColor(input, geo)) { ok = false; break; }
                    }
                }
                if(ok) count++;
            }
            return count;
        }

        function renderSolver() {
            let possibleRedLocs = [];
            let manualRed = null;
            let counts = { orange:0, yellow:0, green:0 };
            
            // 1. Contar fichas ya encontradas
            for(let r=0; r<5; r++) for(let c=0; c<5; c++) {
                let val = sState.inputs[r][c];
                if(val==='red') manualRed = {r,c};
                if(val==='orange') counts.orange++;
                if(val==='yellow') counts.yellow++;
                if(val==='green') counts.green++;
            }
            
            // 2. Determinar candidatos
            if(manualRed) {
                possibleRedLocs.push(manualRed);
            } else {
                for(let r=0; r<5; r++) for(let c=0; c<5; c++) {
                    if(r===2 && c===2) continue;
                    let ok = true;
                    for(let ir=0; ir<5; ir++) for(let ic=0; ic<5; ic++) {
                        let input = sState.inputs[ir][ic];
                        if(input && input!=='red') {
                            let geo = getGeoType(r,c,ir,ic);
                            if (!isValidForColor(input, geo)) { ok = false; break; }
                        }
                    }
                    if(ok) possibleRedLocs.push({r,c});
                }
            }

            document.getElementById('s-status').innerText = `${possibleRedLocs.length} Possible`;

            // 3. IA DE SUGERENCIA (GREEDY + COUNT AWARE)
            let suggestion = null;
            let maxEV = -1;

            if (possibleRedLocs.length > 0 && possibleRedLocs.length < 24) {
                 for(let r=0; r<5; r++) for(let c=0; c<5; c++) {
                     if (!sState.inputs[r][c]) {
                         let totalScore = 0;
                         possibleRedLocs.forEach(loc => {
                             let geo = getGeoType(loc.r, loc.c, r, c);
                             let score = 10; // Base blue
                             
                             if (geo === 'red') score = 150;
                             else if (geo === 'adj') score = (counts.orange < 2) ? 90 : 35; // Si naranjas agotadas (2), es verde/turq
                             else if (geo === 'diag') score = (counts.yellow < 3) ? 55 : 20; // Si amarillas agotadas (3), es turq
                             else if (geo === 'line') score = (counts.green < 4) ? 35 : 20; // Si verdes agotadas (4), es turq
                             
                             totalScore += score;
                         });
                         
                         let ev = totalScore / possibleRedLocs.length;
                         
                         // Boost pequeño si aún buscamos a la roja para romper empates azules
                         if (possibleRedLocs.length > 1 && !manualRed) {
                             let blueCount = 0;
                             possibleRedLocs.forEach(loc => {
                                 if(getGeoType(loc.r, loc.c, r, c) === 'far') blueCount++;
                             });
                             let splitScore = (1 - Math.abs(0.5 - (blueCount/possibleRedLocs.length))) * 25;
                             ev += splitScore;
                         }

                         if(ev > maxEV) { maxEV = ev; suggestion = {r,c}; }
                     }
                 }
            } else if (possibleRedLocs.length === 24 && !sState.inputs[2][2]) {
                suggestion = {r:2, c:2};
            }

            // 4. Render Grid
            for(let r=0; r<5; r++) for(let c=0; c<5; c++) {
                let cell = document.getElementById(`s-cell-${r}-${c}`);
                if(cell) { 
                    cell.className = 'cell'; 
                    cell.classList.remove('suggestion', 'red-candidate');
                    let input = sState.inputs[r][c]; 
                    if(input) cell.classList.add('input-'+input); 
                    else if(!manualRed) {
                        let isPossible = possibleRedLocs.some(loc => loc.r===r && loc.c===c);
                        if(isPossible) cell.classList.add('red-candidate'); // Borde sutil rojo
                        else cell.classList.add('eliminated'); 
                    }
                    if(suggestion && r===suggestion.r && c===suggestion.c) cell.classList.add('suggestion');
                }
            }
        }

        // ============================================
        // UTILS
        // ============================================
        function showError(msg) { 
            let el=document.getElementById('s-error'); 
            if(el){ el.innerText=msg; el.style.opacity=1; setTimeout(()=>el.style.opacity=0,1000); }
        }
        function manualLangChange(val) { setLanguage(val); }
        
        const translations = {
            es: { practice_title: "Práctica", lbl_hints: "Pistas", btn_restart: "Reiniciar Partida", btn_clear: "Limpiar Todo", colors: { blue: "AZUL", green: "VERDE", turquoise: "TURQ.", yellow: "AMARILLA", orange: "NARANJA", red: "ROJA" }, hints: { blue: "Lejos (Seguro)", green: "Fila/Columna", turquoise: "Línea/Diagonal", yellow: "Cualquier Diagonal", orange: "Lado (Arriba/Abajo/Esq/Der)", red: "¡ENCONTRADA!" }, msgs: { start: "Click centro (3,3).", summary: "RESUMEN" } },
            en: { practice_title: "Practice", lbl_hints: "Hints", btn_restart: "Restart Game", btn_clear: "Clear All", colors: { blue: "BLUE", green: "GREEN", turquoise: "TURQ.", yellow: "YELLOW", orange: "ORANGE", red: "RED" }, hints: { blue: "Far (Safe)", green: "Row/Col", turquoise: "Line/Diag", yellow: "Any Diagonal", orange: "Side (Up/Down/L/R)", red: "FOUND!" }, msgs: { start: "Click center (3,3).", summary: "SCORE" } }
        };
        let curLang = 'es';
        
        function setLanguage(lang) { 
            curLang = lang; document.getElementById('langSelect').value = lang; 
            const t = translations[curLang]; 
            document.querySelectorAll('[data-key]').forEach(el => { 
                const key = el.getAttribute('data-key'); 
                if(t[key]) el.innerText = t[key]; 
            }); 
            renderLog(); 
        }
        
        function renderLog() { 
            const el = document.getElementById('p-log'); if(el){ el.innerHTML = ''; 
            addLogHTML(el, 'start', null, 0); 
            pState.history.forEach(h => addLogHTML(el, h.color, h, h.pts)); 
            if(pState.done) addLogHTML(el, 'summary', null, pState.score); }
        }
        function addLogEntry(type, coords, pts) { addLogHTML(document.getElementById('p-log'), type, coords, pts); }
        function addLogSummary() { addLogHTML(document.getElementById('p-log'), 'summary', null, pState.score); }
        function addLogHTML(el, type, coords, pts) { 
            const t = translations[curLang]; 
            if (type === 'summary') { el.insertAdjacentHTML('beforeend', `<div class="summary-card"><div style="font-size:0.9rem; opacity:0.8">${t.msgs.summary}</div><div style="font-size:1.5rem; font-weight:bold; color:var(--gold)">${pts}</div></div>`); el.scrollTop = el.scrollHeight; return; } 
            let title = (type==='start') ? "" : t.colors[type]; 
            let desc = ""; if(type==='start') desc = t.msgs.start; else if(pState.hints) desc = t.hints[type] || ""; 
            let css = ''; if(type==='blue') css='le-blue'; else if(type==='green') css='le-green'; else if(type==='turquoise') css='le-turq'; else if(type==='yellow') css='le-yell'; else if(type==='orange') css='le-orng'; else if(type==='red') css='le-red'; 
            let html = `<div class="log-entry ${css}"><div class="log-num">${coords ? pState.history.findIndex(h=>h===coords)+1 : '#'}</div><div class="log-desc">${title ? `<strong>${title}</strong>` : ''} ${coords ? `(${coords.r+1},${coords.c+1})` : ''}${desc ? `<span class="hint-text">${desc}</span>` : ''}</div>${pts>0 ? `<div class="log-pts">+${pts}</div>` : ''}</div>`; 
            el.insertAdjacentHTML('beforeend', html); el.scrollTop = el.scrollHeight; 
        }

        // Init
        const userLang = navigator.language || navigator.userLanguage;
        setLanguage(userLang.startsWith('es') ? 'es' : 'en');
        resetPractice();
        resetSolver();
    </script>
</body>
</html>
